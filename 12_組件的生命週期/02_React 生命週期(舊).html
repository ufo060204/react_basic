<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>02_React 生命週期(舊)</title>
</head>
<style>
</style>

<body>
  <!-- 準備好一個容器 -->
  <div id="test"></div>
  <div id="test2"></div>
  <!-- 引入 React 核心 -->
  <script type="text/javascript" src="../js/react.development.js"></script>
  <!-- 引入 React DOM 操作 -->
  <script type="text/javascript" src="../js/react-dom.development.js"></script>
  <!-- 引入 Babel 轉譯器 -->
  <script type="text/javascript" src="../js/babel.min.js"></script>
  <!-- 引入 prop-types 用於對組件標籤類型進行限制 -->
  <script type="text/javascript" src="../js/prop-types.js"></script>
  <script type="text/babel">
    /*
    1. 初始化階段：由 ReactDOM.render() 觸發---初次渲染
      1.1 constructor()
      1.2 componentWillMount()
      1.3 render()
      1.4 componentDidMount() ===> 常用
        一般在這個鉤子做一些初始化的事, 例如：發送 ajax 請求、啟動定時器、訂閱消息
    2. 更新階段：由組件內部 this.setState() 或父組件 render 觸發
      2.1 shouldComponentUpdate()
      2.2 componentWillUpdate()
      2.3 render() ===> 必須使用
      2.4 componentDidUpdate()
    3. 卸載階段：由 ReactDOM.unmountComponentAtNode() 觸發
      3.1 componentWillUnmount() ===> 常用
        一般在這個鉤子做一些收尾的事, 例如：清除定時器、取消訂閱消息
    */

    // 創建組建
    class Count extends React.Component {
      // 構造器
      constructor(props) {
        console.log('Count---constructor')
        super(props)
        // 初始化狀態
        this.state = {count: 0}
      }

      // 加 1 按鈕的回調
      add = () => {
        // 獲取原本的 count 狀態
        const {count} = this.state
        // 更新狀態
        this.setState({count: count + 1})
      }

      // 卸載組件按鈕的回調
      death = () => {
        ReactDOM.unmountComponentAtNode(document.getElementById('test'))
      }

      // 強制更新按鈕的回調
      force = () => {
        this.forceUpdate()
      }
      
      // 組件將要掛載的鉤子
      componentWillMount() {
        console.log('Count---componentWillMount')
      }

      // 組件掛載完畢的鉤子
      componentDidMount() {
        console.log('Count---componentDidMount')
      }

      // 組件將要卸載的鉤子
      componentWillUnmount() {
        console.log('Count---componentWillUnmount')
      }

      // 控制組件更新的'閥門'
      shouldComponentUpdate() {
        console.log('Count---shouldComponentUpdate')
        return false
      }

      // 組件將要更新的鉤子
      componentWillUpdate() { 
        console.log('Count---componentWillUpdate')
      }

      // 組件更新完畢的鉤子
      componentDidUpdate() {
        console.log('Count---componentDidUpdate')
      }
      
      render() {
        console.log('Count---render')
        const {count} = this.state
        return (
          <div>
            <h2>當前求和: {count}</h2>
            <button onClick={this.add}>點我 + 1</button>
            <button onClick={this.death} >卸載組件</button>
            <button onClick={this.force} >不更改任何狀態中的數據，強制更新一下</button>
          </div>
        )
      }
    }
    
    class A extends React.Component {
      // 初始化狀態
      state = {carName: '特斯拉'}

      changeCar = () => {
        this.setState({carName: '保時捷'})
      }

      render() {
        return(
          <div>
            <div>我是 A 組件</div>
            <button onClick={this.changeCar}>換車</button>
            <B carName={this.state.carName}/>
          </div>
        ) 
      }
    }

    class B extends React.Component {
      // 組件掛載完畢的鉤子
      componentDidMount() {
        console.log('B---componentDidMount')
      }
      // 組件將要接收到新的 props 的鉤子 注意：第一次不會調用！第二次開始才會
      componentWillReceiveProps(props) {
        console.log('B---componentWillReceiveProps', props)
      }
      // 控制組件更新的'閥門'
      shouldComponentUpdate() {
        console.log('B---shouldComponentUpdate')
        return true
      }
      // 組件將要更新的鉤子
      componentWillUpdate() {
        console.log('B---componentWillUpdate')
      }
      // 組件更新完畢的鉤子
      componentDidUpdate() {
        console.log('B---componentDidUpdate')
      }

      render() {
        console.log('B---render')
        return(
          <div>我是 B 組件，接收到的車是：{this.props.carName}</div>
        )
      }
    }
    
    // 渲染組件
    ReactDOM.render(<Count />, document.getElementById('test'))
    ReactDOM.render(<A />, document.getElementById('test2'))
  </script>
</body>

</html>